<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>India Boundary Corrector - Config Editor</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script type="importmap">
    {
      "imports": {
        "@india-boundary-corrector/data": "./packages/data/index.js",
        "@india-boundary-corrector/layer-configs": "./packages/layer-configs/dist/index.js",
        "@india-boundary-corrector/tilefixer": "./packages/tilefixer/dist/index.js",
        "@india-boundary-corrector/leaflet-layer": "./packages/leaflet-layer/dist/index.js",
        "pmtiles": "https://esm.sh/pmtiles@4.0.1"
      }
    }
  </script>
  <style>
    * { box-sizing: border-box; }
    body { 
      margin: 0; 
      padding: 0; 
      font-family: system-ui, -apple-system, sans-serif;
      display: flex;
      height: 100vh;
    }
    
    #sidebar {
      width: 400px;
      min-width: 300px;
      padding: 15px;
      background: #f5f5f5;
      overflow-y: auto;
      border-right: 1px solid #ddd;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }
    
    #sidebar h1 {
      margin: 0;
      font-size: 1.3rem;
      color: #333;
    }
    
    #sidebar h2 {
      margin: 0 0 8px 0;
      font-size: 1rem;
      color: #555;
    }
    
    .section {
      background: white;
      padding: 12px;
      border-radius: 6px;
      border: 1px solid #ddd;
    }
    
    label {
      display: block;
      margin-bottom: 4px;
      font-size: 0.85rem;
      color: #666;
    }
    
    input[type="text"], select, textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
      font-size: 0.9rem;
      font-family: inherit;
    }
    
    input[type="text"]:focus, select:focus, textarea:focus {
      outline: none;
      border-color: #007bff;
    }
    
    textarea {
      font-family: 'Monaco', 'Menlo', 'Consolas', monospace;
      font-size: 0.8rem;
      resize: vertical;
    }
    
    #configEditor {
      min-height: 300px;
    }
    
    button {
      padding: 10px 16px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
    }
    
    button:hover {
      background: #0056b3;
    }
    
    button:disabled {
      background: #ccc;
      cursor: not-allowed;
    }
    
    .error {
      color: #dc3545;
      font-size: 0.85rem;
      margin-top: 5px;
    }
    
    .success {
      color: #28a745;
      font-size: 0.85rem;
      margin-top: 5px;
    }
    
    #map { 
      flex: 1;
      height: 100%;
    }
    
    .tile-preset {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }
    
    .tile-preset button {
      flex: 1;
      padding: 6px 10px;
      font-size: 0.8rem;
      background: #6c757d;
    }
    
    .tile-preset button:hover {
      background: #545b62;
    }
    
    .tile-preset button.active {
      background: #007bff;
    }
  </style>
</head>
<body>
  <div id="sidebar">
    <h1>üó∫Ô∏è India Boundary Corrector</h1>
    <p style="margin: 0; font-size: 0.85rem; color: #666;">Config Editor - Test different tile layers and layer configurations</p>
    
    <div class="section">
      <h2>PMTiles URL</h2>
      <input type="text" id="pmtilesUrl" value="packages/data/india_boundary_corrections.pmtiles">
    </div>
    
    <div class="section">
      <h2>Tile Layer</h2>
      <div class="tile-preset">
        <button id="btnCartoDark" class="active">Carto Dark</button>
        <button id="btnOsmCarto">OSM Carto</button>
        <button id="btnCustom">Custom</button>
      </div>
      <label for="tileUrl">Tile URL Template</label>
      <input type="text" id="tileUrl" value="https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png">
      <label for="tileAttribution" style="margin-top: 8px;">Attribution</label>
      <input type="text" id="tileAttribution" value="&copy; OpenStreetMap &copy; CARTO">
    </div>
    
    <div class="section">
      <h2>Layer Config</h2>
      <textarea id="configEditor">{
  "id": "osm-carto-dark",
  "startZoom": 0,
  "zoomThreshold": 5,
  "tileUrlPattern": "(cartocdn\\.com|cartodb-basemaps).*dark_all",
  "osmAddLineColor": "rgb(40, 40, 40)",
  "neAddLineColor": "rgb(40, 40, 40)",
  "addLineDashed": false,
  "addLineDashArray": [],
  "addLineHaloRatio": 0,
  "addLineHaloAlpha": 0,
  "lineWidthMultiplier": 1.0
}</textarea>
      <div id="configStatus"></div>
    </div>
    
    <button id="applyBtn">Apply Configuration</button>
    
    <div class="section" style="margin-top: auto;">
      <h2>Resources</h2>
      <ul style="margin: 0; padding-left: 20px; font-size: 0.85rem;">
        <li><a href="examples/">Examples</a></li>
        <li><a href="https://github.com/ramSeraph/india_boundary_corrector">GitHub Repository</a></li>
      </ul>
    </div>
  </div>
  
  <div id="map"></div>

  <script type="module">
    import L from 'https://esm.sh/leaflet@1.9.4';
    import { extendLeaflet } from './packages/leaflet-layer/dist/index.js';
    import { LayerConfig } from './packages/layer-configs/dist/index.js';
    
    // Extend Leaflet with CorrectedTileLayer
    extendLeaflet(L);

    // Preset configs
    const presets = {
      cartoDark: {
        tileUrl: 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',
        attribution: '&copy; OpenStreetMap &copy; CARTO',
        config: {
          id: 'osm-carto-dark',
          startZoom: 0,
          zoomThreshold: 5,
          tileUrlPattern: '(cartocdn\\.com|cartodb-basemaps).*dark_all',
          osmAddLineColor: 'rgb(40, 40, 40)',
          neAddLineColor: 'rgb(40, 40, 40)',
          addLineDashed: false,
          addLineDashArray: [],
          addLineHaloRatio: 0,
          addLineHaloAlpha: 0,
          lineWidthMultiplier: 1.0
        }
      },
      osmCarto: {
        tileUrl: 'https://tile.openstreetmap.org/{z}/{x}/{y}.png',
        attribution: '&copy; OpenStreetMap contributors',
        config: {
          id: 'osm-carto',
          startZoom: 1,
          zoomThreshold: 1,
          tileUrlPattern: 'tile\\.openstreetmap\\.org.*\\.png',
          osmAddLineColor: '#b9a8b9',
          neAddLineColor: '#b9a8b9',
          addLineDashed: true,
          addLineDashArray: [10, 1, 2, 1],
          addLineHaloRatio: 1.0,
          addLineHaloAlpha: 0.5,
          lineWidthMultiplier: 1.5
        }
      },
      custom: {
        tileUrl: 'https://tile.openstreetmap.de/{z}/{x}/{y}.png',
        attribution: '&copy; OpenStreetMap contributors',
        config: {
          id: 'custom',
          startZoom: 0,
          zoomThreshold: 5,
          // tileUrlPattern: 'your-pattern-here',
          osmAddLineColor: 'rgb(180, 195, 180)',
          neAddLineColor: 'rgb(180, 195, 180)',
          addLineDashed: true,
          addLineDashArray: [10, 1, 2, 1],
          addLineHaloRatio: 1.0,
          addLineHaloAlpha: 0.5,
          lineWidthMultiplier: 1.0
        }
      }
    };

    let currentPreset = 'cartoDark';
    let map = null;
    let currentLayer = null;

    // DOM elements
    const pmtilesUrlInput = document.getElementById('pmtilesUrl');
    const tileUrlInput = document.getElementById('tileUrl');
    const tileAttributionInput = document.getElementById('tileAttribution');
    const configEditor = document.getElementById('configEditor');
    const configStatus = document.getElementById('configStatus');
    const applyBtn = document.getElementById('applyBtn');
    const btnCartoDark = document.getElementById('btnCartoDark');
    const btnOsmCarto = document.getElementById('btnOsmCarto');
    const btnCustom = document.getElementById('btnCustom');

    function setActiveButton(preset) {
      btnCartoDark.classList.toggle('active', preset === 'cartoDark');
      btnOsmCarto.classList.toggle('active', preset === 'osmCarto');
      btnCustom.classList.toggle('active', preset === 'custom');
    }

    function loadPreset(preset) {
      currentPreset = preset;
      const p = presets[preset];
      tileUrlInput.value = p.tileUrl;
      tileAttributionInput.value = p.attribution;
      configEditor.value = JSON.stringify(p.config, null, 2);
      setActiveButton(preset);
      configStatus.innerHTML = '';
    }

    function parseConfig() {
      try {
        const config = JSON.parse(configEditor.value);
        configStatus.innerHTML = '<span class="success">‚úì Valid JSON</span>';
        return config;
      } catch (e) {
        configStatus.innerHTML = `<span class="error">‚úó Invalid JSON: ${e.message}</span>`;
        return null;
      }
    }

    function applyConfiguration() {
      const configObj = parseConfig();
      if (!configObj) return;

      const pmtilesUrl = pmtilesUrlInput.value.trim();
      const tileUrl = tileUrlInput.value.trim();
      const attribution = tileAttributionInput.value;

      if (!pmtilesUrl) {
        configStatus.innerHTML = '<span class="error">‚úó PMTiles URL is required</span>';
        return;
      }

      if (!tileUrl) {
        configStatus.innerHTML = '<span class="error">‚úó Tile URL is required</span>';
        return;
      }

      try {
        const layerConfig = new LayerConfig(configObj);

        // Remove existing layer
        if (currentLayer) {
          map.removeLayer(currentLayer);
        }

        // Create new corrected tile layer
        currentLayer = L.tileLayer.corrected(tileUrl, {
          attribution,
          maxZoom: 19,
          pmtilesUrl,
          layerConfig
        }).addTo(map);

        configStatus.innerHTML = '<span class="success">‚úì Configuration applied!</span>';
      } catch (e) {
        configStatus.innerHTML = `<span class="error">‚úó Error: ${e.message}</span>`;
      }
    }

    // Initialize map
    map = L.map('map').setView([28.6, 77.2], 5);

    // Event listeners
    btnCartoDark.addEventListener('click', () => loadPreset('cartoDark'));
    btnOsmCarto.addEventListener('click', () => loadPreset('osmCarto'));
    btnCustom.addEventListener('click', () => loadPreset('custom'));
    applyBtn.addEventListener('click', applyConfiguration);
    configEditor.addEventListener('input', parseConfig);

    // Initial apply
    applyConfiguration();
  </script>
</body>
</html>
